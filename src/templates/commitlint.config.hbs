const emojiToTypeMap = {{{emojiToTypeMap}}};

module.exports = {
  extends: ['@commitlint/config-conventional'],
  parserPreset: {
    parserOpts: {
      headerPattern: {{{pattern}}},
      headerCorrespondence: ['emoji', 'type', 'subject'],
    },
  },
  plugins: [
    {
      rules: {
        'emoji-type-match': (parsed) => {
          const emoji = parsed.emoji;
          const type = parsed.type;
          
          if (!emoji || !type) {
            return [false, '提交信息格式错误：缺少 emoji 或 type'];
          }
          
          const expectedType = emojiToTypeMap[emoji];
          if (!expectedType) {
            return [false, `未知的 emoji: ${emoji}`];
          }
          
          if (expectedType !== type) {
            return [false, `emoji ${emoji} 对应的 type 应该是 ${expectedType}，但当前是 ${type}`];
          }
          
          return [true];
        },
      },
    },
  ],
  rules: {
    // type 枚举验证
    'type-enum': [
      2,
      'always',
      {{{typeEnum}}},
    ],
    // type 不能为空
    'type-empty': [2, 'never'],
    // subject 不能为空
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    // scope 不使用
    'scope-empty': [0, 'always'],
    // 验证 emoji 和 type 的映射关系
    'emoji-type-match': [2, 'always'],
  },
};

